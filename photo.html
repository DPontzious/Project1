<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
        crossorigin="anonymous">
    <style>

        img {
    height: 400px;
}
    </style>
</head>

<body>


    <div class="container">
        <div class="row">
            <div class="col">
                <input type="file" value="upload" id="fileButton" />
            </div>
        </div>
        <div class="row">
            <div class="col" id="image-view"></div>
        </div>

        <div class="row">
            <div class="col">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">

                    </ol>
                    <div class="carousel-inner">

                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>

            </div>
        </div>
    </div>






    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAjOckR80NCLOYl1Pb3M1EPwz1TnRBS0AY",
            authDomain: "project-25482.firebaseapp.com",
            databaseURL: "https://project-25482.firebaseio.com",
            projectId: "project-25482",
            storageBucket: "project-25482.appspot.com",
            messagingSenderId: "776832260377"
        };
        firebase.initializeApp(config);

        var images = [];
        var storageRef;
        var database = firebase.database();



        var fileButton = $("#fileButton");

        fileButton.on("change", function (e) {

            var file = e.target.files[0];

            storageRef = firebase.storage().ref('photos/' + file.name);

            console.log("File Name: " + file.name);

            images.push(file.name);

            console.log(images);

            storageRef.put(file);

            database.ref().set({
                imgArr: images
            });




        });

        var i = 0;
        database.ref().on("value", function (snapshot) {

            console.log(snapshot.child('imgArr').exists());



            $(".carousel-indicators").empty();
            $(".carousel-inner").empty();

            if (snapshot.child('imgArr').exists()) {
                images = snapshot.val().imgArr;



                images.forEach(function (img) {

                    var imgHolder = $("<img>");


                    var storage = firebase.storage();
                    var pathReference = storage.ref('photos/' + img);
                    pathReference.getDownloadURL().then(function (url) {
                        console.log("URL: " + url);
                        imgHolder.attr("src", url);

                    }).catch(function (error) {
                        // Handle any errors
                    });


                    var carouselIndicator = $("<li>").attr("data-target", "#carouselExampleIndicators");
                    carouselIndicator.attr("data-slide-to", i);

                    var imageDiv = $("<div>").addClass("carousel-item");

                    imgHolder.attr("alt", "wedding");
                    imgHolder.addClass("d-block w-100");



                    if (i === 0) {
                        i++;
                        carouselIndicator.addClass("active");
                        imageDiv.addClass("active");
                    } else {
                        i++;

                    }

                    $(".carousel-indicators").append(carouselIndicator);
                    imageDiv.append(imgHolder);
                    $(".carousel-inner").append(imageDiv);




                });


            }


        }, function (errorObject) {

            // In case of error this will print the error
            console.log("The read failed: " + errorObject.code);
        });
    </script>
</body>

</html>